<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Office D&D Hub</title>
  <style>
    :root{
      --panel: rgba(0,0,0,.55);
      --panel2: rgba(0,0,0,.35);
      --text: #f5f2e9;
      --accent: #ffd24a;
      --danger: #ff6b6b;
      --ok: #4dff88;
      --shadow: rgba(0,0,0,.55);
    }

    /* Pixel-y look */
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100svh;
      color: var(--text);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      letter-spacing: .2px;
      overflow-x: hidden;
    }

    /* 16-bit pixel art "scenery" background (CSS-only placeholder) */
    .bg {
      position: fixed;
      inset: 0;
      z-index: -2;
      image-rendering: pixelated;
      background:
        /* stars */
        radial-gradient(circle at 12% 18%, rgba(255,255,255,.9) 0 1px, transparent 2px),
        radial-gradient(circle at 32% 12%, rgba(255,255,255,.8) 0 1px, transparent 2px),
        radial-gradient(circle at 62% 22%, rgba(255,255,255,.7) 0 1px, transparent 2px),
        radial-gradient(circle at 78% 10%, rgba(255,255,255,.7) 0 1px, transparent 2px),
        radial-gradient(circle at 88% 26%, rgba(255,255,255,.8) 0 1px, transparent 2px),

        /* sky gradient */
        linear-gradient(#10142a, #1c2a4a 40%, #2b3b5f 70%, #2b3b5f 100%);
      filter: saturate(1.1);
    }

    /* "Mountains" + "ground" layers using blocky gradients */
    .bg::before, .bg::after{
      content:"";
      position: absolute;
      inset: 0;
      image-rendering: pixelated;
    }

    .bg::before{
      /* distant mountains */
      background:
        linear-gradient(transparent 55%, rgba(0,0,0,.0) 55%),
        repeating-linear-gradient(
          90deg,
          transparent 0 24px,
          rgba(255,255,255,.03) 24px 26px,
          transparent 26px 44px
        ),
        linear-gradient(transparent 0 58%, #1a223d 58% 72%, transparent 72%),
        linear-gradient(transparent 0 62%, #121a33 62% 80%, transparent 80%),
        linear-gradient(transparent 0 66%, #0e152e 66% 100%);
      clip-path: polygon(0 60%, 10% 55%, 18% 61%, 28% 52%, 40% 62%, 52% 50%, 64% 63%, 76% 54%, 88% 60%, 100% 56%, 100% 100%, 0 100%);
      opacity: .9;
    }

    .bg::after{
      /* foreground ground + trees silhouette blocks */
      background:
        linear-gradient(transparent 0 74%, #14211c 74% 100%),
        radial-gradient(circle at 10% 76%, #0f1a16 0 42px, transparent 43px),
        radial-gradient(circle at 20% 78%, #0f1a16 0 55px, transparent 56px),
        radial-gradient(circle at 86% 78%, #0f1a16 0 60px, transparent 61px),
        radial-gradient(circle at 76% 77%, #0f1a16 0 44px, transparent 45px);
      opacity: .95;
    }

    /* subtle pixel grid overlay */
    .pixel-grid{
      position: fixed;
      inset: 0;
      z-index: -1;
      pointer-events: none;
      background:
        linear-gradient(rgba(255,255,255,.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,.03) 1px, transparent 1px);
      background-size: 10px 10px;
      mix-blend-mode: overlay;
      opacity: .25;
    }

    header{
      padding: 28px 18px 8px;
      max-width: 980px;
      margin: 0 auto;
    }

    .titlebar{
      display:flex;
      gap: 12px;
      align-items: baseline;
      flex-wrap: wrap;
    }

    h1{
      margin: 0;
      font-size: 28px;
      text-shadow: 0 6px 18px var(--shadow);
    }

    .subtitle{
      opacity: .9;
      font-size: 14px;
      margin-top: 6px;
    }

    main{
      max-width: 980px;
      margin: 0 auto;
      padding: 14px 18px 40px;
      display: grid;
      grid-template-columns: 1.1fr .9fr;
      gap: 14px;
    }

    @media (max-width: 900px){
      main { grid-template-columns: 1fr; }
    }

    .card{
      background: var(--panel);
      border: 2px solid rgba(255,255,255,.12);
      border-radius: 10px;
      box-shadow: 0 14px 40px rgba(0,0,0,.35);
      overflow: hidden;
    }

    .card h2{
      margin: 0;
      padding: 12px 14px;
      font-size: 16px;
      background: rgba(0,0,0,.35);
      border-bottom: 1px solid rgba(255,255,255,.12);
    }

    .card .body{
      padding: 14px;
    }

    .row{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      margin-bottom: 12px;
    }

    label{
      font-size: 12px;
      opacity: .9;
    }

    input, select, button{
      font-family: inherit;
      color: var(--text);
      background: rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.18);
      border-radius: 8px;
      padding: 10px 10px;
      outline: none;
    }

    input[type="number"]{ width: 90px; }

    button{
      cursor: pointer;
      transition: transform .03s ease;
      user-select: none;
    }
    button:active{ transform: translateY(1px); }

    .btn-accent{
      border-color: rgba(255,210,74,.55);
      box-shadow: 0 0 0 2px rgba(255,210,74,.12) inset;
    }

    .btn-danger{
      border-color: rgba(255,107,107,.55);
      box-shadow: 0 0 0 2px rgba(255,107,107,.10) inset;
    }

    .dice-grid{
      display:grid;
      grid-template-columns: repeat(4, minmax(0,1fr));
      gap: 10px;
    }
    @media (max-width: 520px){
      .dice-grid{ grid-template-columns: repeat(3, minmax(0,1fr)); }
    }

    .die-btn{
      padding: 12px 10px;
      text-align:center;
      font-weight: 700;
      letter-spacing: .6px;
      background: rgba(0,0,0,.28);
    }

    .result{
      display:flex;
      gap: 12px;
      align-items: center;
      padding: 12px 14px;
      background: var(--panel2);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 10px;
      margin-top: 10px;
    }

    .big{
      font-size: 28px;
      font-weight: 800;
      color: var(--accent);
      text-shadow: 0 6px 18px rgba(0,0,0,.55);
      min-width: 70px;
      text-align: center;
    }

    .meta{
      font-size: 12px;
      line-height: 1.35;
      opacity: .95;
    }

    .history{
      display:flex;
      flex-direction: column;
      gap: 10px;
    }

    .history-item{
      padding: 10px 12px;
      background: rgba(0,0,0,.28);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 10px;
      font-size: 12px;
      line-height: 1.35;
      display:flex;
      justify-content: space-between;
      gap: 10px;
    }

    .tag{
      opacity: .9;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.16);
      font-size: 11px;
      white-space: nowrap;
    }

    .crit{ color: var(--ok); border-color: rgba(77,255,136,.45); }
    .fumble{ color: var(--danger); border-color: rgba(255,107,107,.45); }

    footer{
      max-width: 980px;
      margin: 0 auto;
      padding: 0 18px 26px;
      opacity: .85;
      font-size: 12px;
    }
    a{ color: var(--accent); }
  </style>
</head>
<body>
  <div class="bg"></div>
  <div class="pixel-grid"></div>

  <header>
    <div class="titlebar">
      <h1>Office D&D Hub</h1>
      <div class="tag">Roll dice • Track chaos • Respect initiative</div>
    </div>
    <div class="subtitle">A tiny corner of the realm for your campaign notes, schedules, and totally fair dice.</div>
  </header>

  <main>
    <section class="card">
      <h2>Dice Roller</h2>
      <div class="body">
        <div class="row">
          <div>
            <label for="count"># of dice</label><br>
            <input id="count" type="number" min="1" max="50" value="1">
          </div>

          <div>
            <label for="mod">Modifier</label><br>
            <input id="mod" type="number" min="-99" max="99" value="0">
          </div>

          <div>
            <label for="mode">d20 mode</label><br>
            <select id="mode">
              <option value="normal">Normal</option>
              <option value="adv">Advantage</option>
              <option value="dis">Disadvantage</option>
            </select>
          </div>

          <div style="flex:1"></div>

          <button class="btn-danger" id="clearBtn" title="Clear history">Clear</button>
        </div>

        <div class="dice-grid" id="diceGrid">
          <button class="die-btn btn-accent" data-sides="4">d4</button>
          <button class="die-btn btn-accent" data-sides="6">d6</button>
          <button class="die-btn btn-accent" data-sides="8">d8</button>
          <button class="die-btn btn-accent" data-sides="10">d10</button>
          <button class="die-btn btn-accent" data-sides="12">d12</button>
          <button class="die-btn btn-accent" data-sides="20">d20</button>
          <button class="die-btn btn-accent" data-sides="100">d100</button>
          <button class="die-btn" id="customBtn" title="Roll custom dice like d7">Custom…</button>
        </div>

        <div class="result" id="resultBox" style="display:none;">
          <div class="big" id="total">—</div>
          <div class="meta" id="details"></div>
        </div>
      </div>
    </section>

    <aside class="card">
      <h2>Roll History</h2>
      <div class="body">
        <div class="history" id="history"></div>
      </div>
    </aside>
  </main>

  <footer>
    Tip: This page works offline. If you want a real pixel-art background image, drop a <code>bg.png</code> next to this file and swap one CSS line (instructions inside the JS).
  </footer>

  <script>
    const el = (id) => document.getElementById(id);

    const countEl = el("count");
    const modEl = el("mod");
    const modeEl = el("mode");
    const resultBox = el("resultBox");
    const totalEl = el("total");
    const detailsEl = el("details");
    const historyEl = el("history");
    const clearBtn = el("clearBtn");

    // --- Optional: Replace CSS scenery background with a real 16-bit pixel-art image ---
    // 1) Put bg.png in the same folder as index.html
    // 2) Uncomment the next line:
    // document.querySelector(".bg").style.background = "url('bg.png') center/cover no-repeat";

    function randInt(min, max){
      // inclusive
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function rollDie(sides){
      return randInt(1, sides);
    }

    function clamp(n, min, max){
      return Math.max(min, Math.min(max, n));
    }

    function fmtSign(n){
      if (n === 0) return "+0";
      return n > 0 ? `+${n}` : `${n}`;
    }

    function addHistory(item){
      const div = document.createElement("div");
      div.className = "history-item";

      const left = document.createElement("div");
      left.innerHTML = `<div><strong>${item.label}</strong> <span class="tag ${item.tagClass || ""}">${item.tagText || "roll"}</span></div>
                        <div style="opacity:.9">${item.breakdown}</div>`;

      const right = document.createElement("div");
      right.style.textAlign = "right";
      right.innerHTML = `<div style="font-weight:800; font-size:14px; color: var(--accent);">${item.total}</div>
                         <div style="opacity:.75">${item.time}</div>`;

      div.appendChild(left);
      div.appendChild(right);

      historyEl.prepend(div);
    }

    function nowTime(){
      const d = new Date();
      return d.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
    }

    function showResult(total, html){
      totalEl.textContent = total;
      detailsEl.innerHTML = html;
      resultBox.style.display = "flex";
    }

    function roll(sides){
      let count = parseInt(countEl.value || "1", 10);
      let mod = parseInt(modEl.value || "0", 10);
      const mode = modeEl.value;

      count = clamp(count, 1, 50);
      mod = clamp(mod, -99, 99);
      countEl.value = count;
      modEl.value = mod;

      // d20 special: advantage/disadvantage applies to a single d20 roll
      if (sides === 20 && mode !== "normal"){
        const a = rollDie(20);
        const b = rollDie(20);
        const kept = mode === "adv" ? Math.max(a,b) : Math.min(a,b);
        const total = kept + mod;

        const isCrit = kept === 20;
        const isFumble = kept === 1;

        const tagText = isCrit ? "crit" : (isFumble ? "fumble" : (mode === "adv" ? "adv" : "dis"));
        const tagClass = isCrit ? "crit" : (isFumble ? "fumble" : "");

        showResult(
          total,
          `d20 (${mode === "adv" ? "advantage" : "disadvantage"}): rolled <strong>${a}</strong> and <strong>${b}</strong>, kept <strong>${kept}</strong> ${mod ? ` ${fmtSign(mod)}` : ""}`
        );

        addHistory({
          label: `d20 ${mode === "adv" ? "Advantage" : "Disadvantage"}`,
          breakdown: `(${a}, ${b}) → kept ${kept} ${mod ? fmtSign(mod) : ""}`,
          total,
          time: nowTime(),
          tagText,
          tagClass
        });
        return;
      }

      // Normal multi-die roll
      const rolls = [];
      for (let i=0; i<count; i++) rolls.push(rollDie(sides));
      const sum = rolls.reduce((a,b)=>a+b,0);
      const total = sum + mod;

      const isD20Single = (sides === 20 && count === 1);
      const tagText = isD20Single && rolls[0] === 20 ? "crit" : (isD20Single && rolls[0] === 1 ? "fumble" : "roll");
      const tagClass = tagText === "crit" ? "crit" : (tagText === "fumble" ? "fumble" : "");

      showResult(
        total,
        `${count}×d${sides}: [${rolls.join(", ")}] = <strong>${sum}</strong> ${mod ? ` ${fmtSign(mod)}` : ""}`
      );

      addHistory({
        label: `${count}×d${sides}`,
        breakdown: `[${rolls.join(", ")}] = ${sum} ${mod ? fmtSign(mod) : ""}`,
        total,
        time: nowTime(),
        tagText,
        tagClass
      });
    }

    // Hook up dice buttons
    el("diceGrid").addEventListener("click", (e) => {
      const btn = e.target.closest("button");
      if (!btn) return;

      if (btn.id === "customBtn"){
        const raw = prompt("Roll what die? (Example: 7 for d7, or 24 for d24)", "7");
        if (!raw) return;
        const sides = parseInt(raw.replace(/[^\d]/g, ""), 10);
        if (!sides || sides < 2 || sides > 1000){
          alert("Pick a number between 2 and 1000.");
          return;
        }
        roll(sides);
        return;
      }

      const sides = parseInt(btn.dataset.sides, 10);
      if (!sides) return;
      roll(sides);
    });

    // Clear history
    clearBtn.addEventListener("click", () => {
      historyEl.innerHTML = "";
      resultBox.style.display = "none";
    });

    // Quick keyboard: press 4/6/8/0/1/2/3 for dice (0 = d10)
    window.addEventListener("keydown", (e) => {
      if (e.target && (e.target.tagName === "INPUT" || e.target.tagName === "SELECT")) return;

      const map = {
        "4": 4,
        "6": 6,
        "8": 8,
        "0": 10,
        "1": 12,
        "2": 20,
        "3": 100
      };
      if (map[e.key]) roll(map[e.key]);
    });
  </script>
</body>
</html>
